{% extends 'base.html' %}
{% load allauth i18n %}

{% block head_title %}
    {% trans "Email Addresses" %}
{% endblock head_title %}

{% block content %}
<!-- Email Addresses Section -->
<section class="min-h-screen flex items-center justify-center px-4 py-24 mx-auto max-w-7xl bg-base-200">
  <div class="w-full max-w-lg card bg-base-100 shadow-xl">
    <div class="card-body items-center text-center">
      <h1 class="text-2xl font-semibold mb-6">
        {% trans "Email Addresses" %}
      </h1>

      {% if emailaddresses %}
        <p class="mb-6 text-sm text-base-content/70">
          {% trans "The following email addresses are associated with your account:" %}
        </p>

        {% url 'account_email' as email_url %}
        <form method="post" action="{{ email_url }}" class="space-y-6 w-full">
          {% csrf_token %}
          <div class="space-y-4">
            {% for radio in emailaddress_radios %}
              {% with emailaddress=radio.emailaddress %}
                <div class="form-control flex flex-row items-center gap-2">
                  <input
                    type="radio"
                    name="email"
                    value="{{ emailaddress.email }}"
                    id="{{ radio.id }}"
                    {% if radio.checked %}checked{% endif %}
                    class="radio radio-primary"
                  >
                  <label for="{{ radio.id }}" class="label cursor-pointer justify-start gap-2">
                    <span class="label-text">{{ emailaddress.email }}</span>
                    {% if emailaddress.verified %}
                      <span class="badge badge-success badge-sm">
                        {% translate "Verified" %}
                      </span>
                    {% else %}
                      <span class="badge badge-warning badge-sm">
                        {% translate "Unverified" %}
                      </span>
                    {% endif %}
                    {% if emailaddress.primary %}
                      <span class="badge badge-primary badge-sm">
                        {% translate "Primary" %}
                      </span>
                    {% endif %}
                  </label>
                </div>
              {% endwith %}
            {% endfor %}
          </div>

          <div class="flex flex-col gap-4 w-full">
            <button
              type="submit"
              name="action_primary"
              class="btn btn-primary w-full"
            >
              {% trans "Make Primary" %}
            </button>
            <button
              type="submit"
              name="action_send"
              class="btn btn-outline btn-primary w-full"
            >
              {% trans "Re-send Verification" %}
            </button>
            <button
              type="submit"
              name="action_remove"
              class="btn btn-outline btn-error w-full"
            >
              {% trans "Remove" %}
            </button>
          </div>
        </form>
      {% else %}
        <div class="alert alert-info mb-6">
          <p>{% trans "You have not added any email addresses yet." %}</p>
        </div>
      {% endif %}

      {% if can_add_email %}
        <h2 class="mt-8 mb-4 text-xl font-semibold">
          {% trans "Add Email Address" %}
        </h2>
        {% url 'account_email' as action_url %}
        <form method="post" action="{{ action_url }}" class="space-y-6 w-full">
          {% csrf_token %}
          <div class="form-control">
            <label class="label" for="{{ form.email.auto_id }}">
              <span class="label-text">{% trans "Email" %}</span>
            </label>
            <input
              id="{{ form.email.auto_id }}"
              name="email"
              type="email"
              value="{{ form.email.value|default:'' }}"
              class="input input-bordered w-full"
            >
            {% if form.email.errors %}
              <p class="mt-2 text-xs text-error">{{ form.email.errors|join:", " }}</p>
            {% endif %}
          </div>
          <button
            name="action_add"
            type="submit"
            class="btn btn-primary w-full"
          >
            {% trans "Add Email" %}
          </button>
        </form>
      {% endif %}

      <a href="{% url 'profile' %}" class="mt-6 btn btn-neutral w-full">
        Go Back to Profile
      </a>
    </div>
  </div>
</section>
{% endblock content %}

{% block extra_body %}
  <script>
    (function() {
      var message = "{% trans 'Do you really want to remove the selected email address?' %}";
      var actions = document.getElementsByName('action_remove');
      if (actions.length) {
        actions[0].addEventListener("click", function(e) {
          if (!confirm(message)) {
            e.preventDefault();
          }
        });
      }
    })();
  </script>
{% endblock extra_body %}